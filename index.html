<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Acheter un Panel Ptérodactyle</title>
<style>
body{font-family:Arial, sans-serif; background:#f5f7fb; margin:0}
header{background:#10121a;color:#fff;padding:18px;text-align:center}
.container{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.06)}
label{display:block;margin:10px 0 6px}
input,select{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px}
button{background:#0070ba;color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer}
small.note{color:#666}
#paymentButtons{display:none;margin-top:16px}
.team{margin-top:28px;padding:14px;background:#0f1724;color:#fff;border-radius:8px;text-align:center}
</style>
</head>
<body>
<header><h1>Acheter un Panel Ptérodactyle</h1><p>Automatisation PayPal + Pterodactyl</p></header>
<div class="container">
<form id="panelForm">
  <label>Panel</label>
  <select id="panel" required>
    <option value="">--Sélectionnez--</option>
    <option value="Node.js">Node.js</option>
    <option value="Python">Python</option>
    <option value="Minecraft">Minecraft</option>
  </select>

  <label>Configuration</label>
  <select id="config" required></select>

  <label>Durée</label>
  <select id="duration">
    <option value="7">7 jours</option>
    <option value="15">15 jours</option>
    <option value="30">30 jours</option>
  </select>

  <label>Nom du panel</label>
  <input id="panelName" required />
  <label>Username</label>
  <input id="username" required />
  <label>Password</label>
  <input id="password" required />
  <label>Email</label>
  <input id="email" type="email" required />

  <p>Prix estimé: <strong id="price">0€</strong></p>
  <button type="button" onclick="validateAndShow()">Valider & Payer</button>
</form>

<div id="paymentButtons">
  <h3>Paiement</h3>
  <button id="paypalBtn">Payer avec PayPal</button>
  <p class="note">Orange: <strong id="orangeNum">+225XXXXXXXX</strong> &mdash; Wave: <strong id="waveNum">+225XXXXXXXX</strong></p>
  <p class="note">Pour Orange/Wave: envoie l'argent au numéro ci-dessus et envoie la preuve sur WhatsApp. Nous créerons le panel manuellement après confirmation (ou via webhook si intégré).</p>
</div>
</div>

<div class="team">
  <h3>Notre équipe</h3>
  <p>Jean N'guessan — Support</p>
</div>

<script>
const configOptions = [
  "1GO/40%CPU","3GO/100%CPU","4GO/150%CPU","6GO/220%CPU","10GO/300%CPU","20GO/450%CPU","30GO/500%CPU","40GO/550%CPU","50GO/600%CPU","Unlimited/unlimited"
];
const prices = {
  "Node.js":[1.5,2,2.9,4,6,6.9,7.5,8,8.9,10],
  "Python":[2,2.5,3,3.5,5,6,7,8,9,12]
};
prices["Minecraft"] = prices["Python"].map(p => Math.round(p * 1.03 * 100)/100);

const configSelect = document.getElementById('config');
configOptions.forEach((c,i)=> {
  const opt = document.createElement('option');
  opt.value = i;
  opt.textContent = c;
  configSelect.appendChild(opt);
});

const panelEl = document.getElementById('panel');
const durationEl = document.getElementById('duration');
const priceEl = document.getElementById('price');

function computePrice(){
  const panel = panelEl.value;
  const cfg = configSelect.value;
  const duration = parseInt(durationEl.value || '7');
  if (!panel || cfg === '') {
    priceEl.textContent = '0€';
    return 0;
  }
  let base = prices[panel][cfg];
  const multiplier = duration / 7;
  const total = Math.round(base * multiplier * 100) / 100;
  priceEl.textContent = total + '€';
  return total;
}
panelEl.addEventListener('change', computePrice);
configSelect.addEventListener('change', computePrice);
durationEl.addEventListener('change', computePrice);

function validateAndShow() {
  const panel = panelEl.value;
  const cfg = configSelect.value;
  const duration = durationEl.value;
  const panelName = document.getElementById('panelName').value;
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  const email = document.getElementById('email').value;
  if (!panel || cfg==='' || !panelName || !username || !password || !email) {
    alert('Remplis tous les champs s\'il te plaît.');
    return;
  }
  // show payment
  document.getElementById('paymentButtons').style.display = 'block';

  // set mobile numbers (from server env? hardcode placeholders)
  document.getElementById('orangeNum').textContent = (window.ORANGE_NUMBER || '+225XXXXXXXX');
  document.getElementById('waveNum').textContent = (window.WAVE_NUMBER || '+225XXXXXXXX');

  // attach PayPal click
  document.getElementById('paypalBtn').onclick = async function(){
    const price = computePrice();
    const payload = {
      panel, config: configOptions[cfg], duration, panelName, username, password, email, price
    };
    try {
      const res = await fetch('/create-paypal-order', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      });
      const j = await res.json();
      if (j.approvalUrl) {
        window.location.href = j.approvalUrl;
      } else {
        alert('Erreur création paiement: ' + (j.error || JSON.stringify(j)));
      }
    } catch (err) {
      alert('Erreur réseau: ' + err.message);
    }
  };
}
</script>
</body>
</html>
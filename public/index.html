<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Acheter un Panel Ptérodactyle</title>
<style>
body {font-family:Arial, sans-serif; background:#f5f7fb; margin:0}
header {background:#10121a;color:#fff;padding:18px;text-align:center}
.container {max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.06)}
label {display:block;margin:10px 0 6px}
input,select {width:100%;padding:10px;border:1px solid #ddd;border-radius:6px}
button {background:#0070ba;color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer}
small.note {color:#666}
#paypal-buttons-container {margin-top:20px}
.team {margin-top:28px;padding:14px;background:#0f1724;color:#fff;border-radius:8px;text-align:center}
</style>
</head>
<body>
<header>
  <h1>Acheter un Panel Ptérodactyle</h1>
  <p>Automatisation PayPal + Carte + Pterodactyl</p>
</header>

<div class="container">
<form id="panelForm">
  <label>Panel</label>
  <select id="panel" required>
    <option value="">--Sélectionnez--</option>
    <option value="Node.js">Node.js</option>
    <option value="Python">Python</option>
    <option value="Minecraft">Minecraft</option>
  </select>

  <label>Configuration</label>
  <select id="config" required></select>

  <label>Durée</label>
  <select id="duration">
    <option value="7">7 jours</option>
    <option value="15">15 jours</option>
    <option value="30">30 jours</option>
  </select>

  <label>Nom du panel</label>
  <input id="panelName" required />
  <label>Username</label>
  <input id="username" required />
  <label>Password</label>
  <input id="password" required />
  <label>Email</label>
  <input id="email" type="email" required />

  <p>Prix estimé : <strong id="price">0€</strong></p>
  <button type="button" id="showPayPalBtn">Valider & Payer</button>
</form>

<div id="paypal-buttons-container" style="display:none;"></div>

<div class="team">
  <h3>Notre équipe</h3>
  <p>Jean N'guessan — Support</p>
</div>

<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=EUR"></script>
<script>
const configOptions = [
  "1GO/40%CPU","3GO/100%CPU","4GO/150%CPU","6GO/220%CPU","10GO/300%CPU",
  "20GO/450%CPU","30GO/500%CPU","40GO/550%CPU","50GO/600%CPU","Unlimited/unlimited"
];

const prices = {
  "Node.js":[1.5,2,2.9,4,6,6.9,7.5,8,8.9,10],
  "Python":[2,2.5,3,3.5,5,6,7,8,9,12]
};
prices["Minecraft"] = prices["Python"].map(p => Math.round(p * 1.03 * 100)/100);

const configSelect = document.getElementById('config');
configOptions.forEach((c,i)=> {
  const opt = document.createElement('option');
  opt.value = i;
  opt.textContent = c;
  configSelect.appendChild(opt);
});

const panelEl = document.getElementById('panel');
const durationEl = document.getElementById('duration');
const priceEl = document.getElementById('price');

function computePrice(){
  const panel = panelEl.value;
  const cfg = configSelect.value;
  const duration = parseInt(durationEl.value || '7');
  if (!panel || cfg === '') { priceEl.textContent = '0€'; return 0; }
  const base = prices[panel][cfg];
  const total = Math.round(base * (duration / 7) * 100) / 100;
  priceEl.textContent = total + '€';
  return total;
}

panelEl.addEventListener('change', computePrice);
configSelect.addEventListener('change', computePrice);
durationEl.addEventListener('change', computePrice);

document.getElementById('showPayPalBtn').addEventListener('click', () => {
  if (!panelEl.value || configSelect.value === '' || !document.getElementById('panelName').value || !document.getElementById('username').value || !document.getElementById('password').value || !document.getElementById('email').value) {
    alert("Remplis tous les champs s'il te plaît.");
    return;
  }

  const container = document.getElementById('paypal-buttons-container');
  container.style.display = "block";
  container.innerHTML = ""; // réinitialise si déjà affiché

  paypal.Buttons({
    createOrder: function(data, actions) {
      const price = computePrice();
      const payload = {
        panel: panelEl.value,
        config: configOptions[configSelect.value],
        duration: durationEl.value,
        panelName: document.getElementById('panelName').value,
        username: document.getElementById('username').value,
        password: document.getElementById('password').value,
        email: document.getElementById('email').value,
        price
      };
      return fetch('/create-paypal-order', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(order => order.id);
    },
    onApprove: function(data, actions) {
      return fetch(`/execute-paypal?orderId=${data.orderID}`)
        .then(res => res.text())
        .then(html => {
          document.body.innerHTML = html;
        });
    }
  }).render('#paypal-buttons-container');
});
</script>
</body>
</html>
